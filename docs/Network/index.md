---
title: 计算机网络
---
## Network

### 图书
- 深入浅出Network

### 问题
- 局域网([Local area network](https://en.wikipedia.org/wiki/Local_area_network))
    - 局域网内设备之间通信
        - 计算机之间如何通信
        - 计算机和手机之间如何通信
    - 路由器的工作
    - 蓝牙设备如何通信
    - [如何扫描网络内的所有设备IP并列出](https://stackoverflow.com/questions/13669585/how-to-get-a-list-of-all-valid-ip-addresses-in-a-local-network)
- 互联网
    - 如何检测网络速度
- IP地址
    - 192.168.1.0/24 是什么意思?
        - 24 为子网掩码的容量
        - 子网掩码由连续的1和0组成，连续的1表示网络地址，连续的0表示主机地址，通过0的个数可以计算出子网的容量（子网中主机的IP地址范围）
    - [子网掩码](https://www.zhihu.com/question/56895036)

### 网络元素
- 接收和发送电信号(Network Interface Card, NIC, 网卡,网络接口卡)
    - 每台计算机都通过网卡接收和发送电信号,并转换为二进制供其他程序使用
    - 功能
        - 网卡接收待发送得消息,编码成为信号,最后通过网络传送
        - 网卡接收信号,利用时钟机制将信号等分为时间片,将信号转换为1和0
        - 网卡处理器芯片负责对信号进行转换
        - 网卡掌管着与编码相关的工作
        - 网卡生成传输网络信号必须的电压
    - MAC, MediaAccess Control
        - 网卡得Read-Only-Memory,ROM芯片存储媒体访问控制(MediaAccess Control)地址,也就是MAC地址
        - Mac地址式独一无二得标识符
        - MAC地址是每台设备的唯一身份证号码,但是不能像IP那样直接看出他所属的位置
        - 问题
            - 如何查看计算机的MAC地址?
            - MAC地址可以改变吗?
                - MAC地址被写入网卡ROM, 一般人无法更改
            - MAC地址是随机数吗?
                - MAC地址包含生产厂商的信息
            - 有人负责MAC地址的分配吗?
                - 美国电气和电子工程师注册管理局负责
            - MAC地址会用完吗?
                - 暂时不会,足够用到2100年,2的48次个
    - IP地址
        - IP地址类似于电话号码的区号
        - 子网掩码
            - 判断两个节点是否处于同一网段(子网), 比如192.168.0.0/16 包含 192.168.0.1 到192.168.100.1, 双方不需要路由器就可以通信
        - 地址识别协议(Address Resolution Protocol,ARP)
            - 实现IP地址转换为MAC地址
        - IP地址由4个字节,32位数字组成,每个字节可表示256个数字,
        - 普通的IP地址是由10进制现实的,比如192.168.100.1,前3个位网段地址,最后为主机地址.192.168.0.1 = 192.168.100.0/24 是一个意思,24 是由2进制转换
        ```
            A网络
                IP网段: 192.168.100.0/24
            路由器连接双方
            B网络
                IP网段: 192.168.101.0/24

        ```
- 将电信号转换为数字(二进制)
    - 存储容量
        - 二进制以2为基数,每个位置可以存储2个值,0和1, . 随着位数由低到高逐渐增加,进行幂次方操作
    - 二进制转换为十进制
        - 将二进制数每一位上的数与这一位代表的2的n次方幂相乘
    - 如何将二进制转换为字母?
        - ascii
        - utf8
    - 问题
        - 为什么计算机不直接使用十进制?
            - 使用十进制要表示十种电信号,必须要采用昂贵的高灵敏的电子设备才可以
        - 为什么要用到二进制?
            - 子网掩码需要二进制知识,监测网络数据包时也需要二进制知识
        - 二进制如何进行加减乘除的运算?

- 将二进制转换为文本(数据编码/解码)
    - 对信号进行编码和解吗是为了搞笑的传输数据
    - 如何将二进制转换为人类可读的文本?
        - ascii
            - ascii 的每个字符都用 1个byte=8bit表示
        - unicode
            - 可以对几百万字符编码
    - 为什么要对数据进行编码?
        如果不对数据编码和解吗,就无法获得二进制并转换为电信号.
        网络存在得目的就是用来传输数据的,所以编码至关重要
    - 为什么有那么多编码规则,而不是一种?
        不同的编码规则各有优点
    - 什么是数据纠错?
        网络上传输的数据难免出错,数据纠错有助于数据的正确性和完整性
    - 有多少种编码规则?
        - ascii 
        - unicode
- 将二进制转换为更短的其他进制
    - 十六进制
        - 二进制转换为十六进制
        - 十六进制转换为十进制
    - 十进制
        - 十进制转换为二进制
        - 十进制转换为十六进制
    - 问题
        - 为什么要用十六进制?
            - 十六进制与二进制有天然的联系,简化了二进制到ASCII的转换过程.十六进制像一座桥梁,将晦涩难懂的二进制与人类连接
```js
let binary = 01100001;//8bit = 1byte
fn convert binary to hex(binary){
    let leftHalfByte =  0110;//这是半字节,截取了1字节的一半,4位数,2的4次方最大值位15.代表16禁止的F. 也就是半字节等于一个16进制的基本单元.1个字节就等于2个16禁止的字符串拼接
    let rightHalfByte = 0001;

    leftHalfByte = 6;//将0110转换为 十六进制的6
    rightHalfByte = 1;//将0001 转换为十六进制的1

    leftHalfByte . rightHalfBute 拼接后去ascii表查找对应的十六进制数

}

```
- 协议
    - 关于协议
        - 为了实现通信,网络设备使用各种协议来交流.协议规定了诸如数据的传输速度和传输结构等标准
        - 大多数的协议规定的消息的长度的上限,原始的消息必须分割为多组消息打包发送
        - 协议定义了消息的结构
    - 消息
        - 格式
            - 数据帧(frame)
                - 前同步信号
                    - 由7个字节组成,为了方便设备间同步时钟信号
                - 帧起始标识
                    - 通知接收设备后面跟着的是数据
                - 目的地MAC地址
                    - 数据帧即将前往的网络设备的物理地址
                - 源MAC地址
                    - 刚才发送消息的物理地址
                - 完整的数据帧
                ```js
                // 前同步信号部分,7个字节,结尾这里无换行为方便阅读换行
                10101010 10101010 10101010 10101010 10101010 10101010 10101010 
                //帧起始标识部分
                10101010
                //目的地mac地址
                00000000 00100101 01000010...
                //源mac地址
                //数据类型
                10111110 11101110
                //负载数据
                10101010 10.....
                ```
                - 数据内容
                    - 单个数据帧最多能放1500字节的数据,如果大于1500字节需要多次传输.既然分成多次传输,就会涉及到重新按顺序组合的问题,必须保证正确的顺序.顺序不同的原因是 不同的包可能会选择不同的路由器路径,类似于多线程不知道谁先到
                    - 如果把数据全都放到一个包内,发送时间会延长,在网络不稳定的情况下可能无法成功.
                    - 数据内从放在上方的 源MAC地址后面
                    - 数据类型
                        - 指明负载数据中是哪种数据类型
                    - 负载数据(payload)
                        - 负载数据是数据帧真正想要传输的内容,即有效的数据部分
                        - 数据内容
                            - IP报头
                            - 目的地IP地址
                            - 源IP地址
                            - 目的地TCP端口
                            - 源TCP端口
                            - TCP报头与数据
                            - TCP循环冗余校验码
                                - 检查数据是否有错
                        - 数据长度    
                - 数据帧内的数据像俄罗斯套娃,以太网数据帧是最外层,然后是ip数据包,后面是TCP,HTTP                        
            - 数据包(packet)
                - 关于数据包
                    - 数据包有很多种类,每种包都含有若干信息,称为field字段,字段包含了与数据包通信相关的信息.
                    - 数据包是数据帧内的数据部分内容
                - 数据包解码

                - UDP数据包
                    - 功能
                        - 传输数据流数据,比如音乐和视频
                    - 数据包结构
                        - IP报头
                            - 版本号
                            - 服务类型
                            - 长度
                            - 标志和便宜
                            - 校验码
                            - 生存时间
                            - 标识符
                            - 协议类型
                        - UDP负载数据
                            - UDP源端口号
                            - UDP目的端口号
                            - 长度
                            - UDP校验码
                            - 数据区
                - ICMP数据包 
                    - 功能
                        - 测试网络连接状态,ping会用到
                    - 数据结构
                        - IP报头
                        - ICMP负载数据
                - TCP数据包
                    - 功能
                        - 用于在IP网络上进行可靠的数据通信,数据不会丢失
                    - 内容格式
                        - tcp包内容为16进制,查看对应的ascii即可
                    - 数据结构
                        - IP报头
                        - TCP负载数据
                            - TCP源端口
                            - TCP目的端口
                                - 解码后读取改内容,发给特定的端口应用
                                - 服务器收到以太网数据帧,根据端口号发送到应用
                            - 序列号
                                - 数据包的顺序号
                            - 确认号
                            - 首部长度
                            - 标志
                            - 窗口大小
                            - 紧急指针
                            - TCP校验码
                            - 选项
                            - 数据区
                    - 解码
                        ```
                        49 20 68 61 76 65 20 74 68 65 20 73 65 63
                        ---->
                        49 对应ascii中的 i, 依照此规律得到 i have the sec
                        ```
        

- 网络设备与网络通信
    - 设备
        - 集线器(hub)
            - 功能
                - 连接(局域网等)网络上的各种设备,包括计算机和打印机
                - 将接收到的信号向自己所有的端口广播(插入各种设备),简单的重复收到的信号
                - 完全不理解数据帧和数据包,只是机械的转发电信号
        - 交换机(switch)
            - 功能
                - 端口 就是设备上的网线插口
                - 也可以连接(局域网等)网络上的各种设备,包括计算机和打印机
                - 可以理解数据帧的内容,解读MAC地址根据MAC地址将数据发送到插入的设备上
                - 交换机上有 地址查询表存储数据
                - 交换机不能跨IP操作
                ```
                    server ----send message ----> 
                    switch ----解析数据包,找到MAC地址转发到插入到交换机的设备上 
                    -------> client 
                ```
        - 路由器(router)
            - 功能
                - 连接外部多个网络
                - 路由器与计算机一样有自己的MAC地址
                - 如果消息是通过路由器发送,就只能追查到路由器.路由器后面的计算机组成了一个IP子网,路由器的作用是连接不同的IP子网
                - 路由器可以解读收到大的所有的数据包,根据数据包的目的IP转发数据包

    - 连接多个网络
        - 路由器维护一个子网,或局域网
        - 路由器可以担任多个网络的翻译,简而言之,路由器翻译网络IP地址

- 数据包监视
    - 软件
        - wireshark
- 网络程序
    - ping
        - 如何自己实现?
    - traceroute 
        - 打印沿途所有的路由器
            ```
                traceroute www.baidu.com
            ```
        - 如何自己实现?
    - 路由器监控
    - PC与收集连接
- DNS
    - 网络程序
        - dig 
### 概念
- 数据流模型
- 数据堆栈
- socket
    - what is socket?
         a socket is a pseudo-file that represents a network connection.Once a socket has been created,writes to the socket are turned into network packets that get sent out, and data received from the network can be read from the socket.
          sockets are very similar to pipes: they look just like files to the programs using them.
          套接字是双向通信（"双工"）的一种方式，这意味着您可以写入和读取同一套字Socket，并且不需要两个单独的套接字进行双向通信.
          套接字为抽象。它为应用程序提供了一个接口，以便利用系统资源（本例中为网络连接），使操作系统能够调解和组织任何数量的应用程序的有限资源的使用。
          
        - Unix domains sockets
            Those are much like regular sockets, except they connect processes on the same host rather than remote processes, and do not attempt to use any network resources at all. In this way, they are a medium of inter-process communication.
        - references
            [what-is-a-socket](https://unix.stackexchange.com/questions/16311/what-is-a-socket)
- connection
- protocol
    - TCP
        - TCP生命周期
        - TCP 标头结构
        - TCP 标头
        - Http 
            - HTTP协议
            - HTTP v1
            - HTTP v2
            - HTTP v3
    - UDP
- data transfer

- Questions
    - [C10k problem](/csbook/docs/internet/c10k)
    - 理论上，服务器可以处理的并发 TCP 连接的最大数量是多少？
        
    - 并发连接请求与并发开放连接
    - 为什么在 TCP 握手成功后连接被拒绝？
    - 什么是主动和被动套接字？
    - What defines a unique connection ?
        - Protocol
        - Source IP address
        - Source port
        - Target IP address
        - Target port
